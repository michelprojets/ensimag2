#include <debug.h>
#include <string.h>
#include <cpu.h>
#include <processus.h>

extern void ctx_sw(uint32_t * ptr_ctxt_p1, uint32_t * ptr_ctxt_p2);

void idle(void)
{
    printf("[idle] je tente de passer la main a proc1...\n");
    ctx_sw(processus_table[0].save_registers, processus_table[1].save_registers);
}

void proc1(void)
{
    printf("[proc1] idle m'a donne la main\n");
    printf("[proc1] j'arrete le systeme\n");
    hlt();
}

void init_processus(void) // EXCCEPTION ICI
{
    processus_table[0].pid = 0;
    strcpy("idle", processus_table[0].nom);
    processus_table[1].pid = 1;
    strcpy("proc1", processus_table[1].nom);
    processus_table[1].save_registers[1] =
                  (uint32_t)(&((processus_table[1].exec_stack)[EXEC_STACK_SIZE-1]));
    (processus_table[1].exec_stack)[EXEC_STACK_SIZE-1] = (uint32_t)proc1;
}
